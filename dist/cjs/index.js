"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@chakra-ui/react"),t=require("react");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=n(t),a=function(n){var a,l=n.email,o=n.logout,i=n.sendEmail,u=function(){var e=t.useState(0),n=e[0],r=e[1],a=t.useRef();return{seconds:n,startCountDown:function(e){a.current||(r(e),a.current=setInterval((function(){r((function(e){return e<0?(clearInterval(a.current),a.current=void 0,0):e-1}))}),1e3))}}}(),c=u.seconds,d=u.startCountDown,f=function(e){var n=t.useState({loading:!1,called:!1}),r=n[0],a=n[1];return[r,function(){return a({loading:!0,called:!0}),e().then((function(e){return a({loading:!1,called:!0}),e})).catch((function(e){console.error(e),a({loading:!1,called:!0,error:e})}))}]}(i),s=f[0],m=s.error,v=s.loading,h=s.called,p=f[1],y=429===(null===(a=null==m?void 0:m.response)||void 0===a?void 0:a.status),E=y?"You've sent to many requests, please try again later.":"An error occurred, please try again.";return r.default.createElement(e.Center,{h:"90vh",m:"auto"},r.default.createElement(e.VStack,{align:"center",w:"40vw",textAlign:"center",spacing:8},r.default.createElement(e.Text,{fontSize:"2xl"},"Almost there â€¦"),r.default.createElement(e.Text,null,"Please check your email ",r.default.createElement("b",null,l)," to confirm your account."),r.default.createElement(e.Divider,null),r.default.createElement(e.Text,null,"If ",r.default.createElement("b",null,l)," is not your email address, please"," ",r.default.createElement(e.Box,{display:"contents",textDecoration:"underline",color:"blue",cursor:"pointer",onClick:function(){return o()}},"click here to go back")," ","and enter the correct one."," "),r.default.createElement(e.Text,null,"If you have not received our email in 15 minutes, please check your spam folder."),r.default.createElement(e.VStack,null,r.default.createElement(e.Text,null,"Still can't find it?"),!y&&r.default.createElement(e.Button,{onClick:function(){return p().then((function(e){var t;d(30),(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.url)&&(window.location.href=e.data.url)}))},variant:"invertedPrimary",w:"fit-content",px:"6",size:"sm",ml:"3",disabled:v||c>0},v?"Loading...":"Resend verification email"),!v&&h&&r.default.createElement(e.Text,{color:m?"warning.600":"secondary.500"},m?E:"Your verification email has been sent, please check your inbox."),c>0&&r.default.createElement(e.Text,{fontSize:"xs"},"You can try again in ",c))))};function l(e,t,n,r){return new(n||(n=Promise))((function(a,l){function o(e){try{u(r.next(e))}catch(e){l(e)}}function i(e){try{u(r.throw(e))}catch(e){l(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}u((r=r.apply(e,t||[])).next())}))}function o(e,t){var n,r,a,l,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return l={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function i(l){return function(i){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&l[0]?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,r=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){o=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){o.label=l[1];break}if(6===l[0]&&o.label<a[1]){o.label=a[1],a=l;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(l);break}a[2]&&o.ops.pop(),o.trys.pop();continue}l=t.call(e,o)}catch(e){l=[6,e],r=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,i])}}}exports.CheckEmailVerification=function(e){var t=e.children,n=e.logout,l=e.sendVerifyEmail;if("undefined"==typeof window)return null;var o=new URLSearchParams(window.location.search).get("error_description"),i="string"==typeof o&&window.atob(o),u=i?JSON.parse(i):{},c=u.email,d=u.userId;return"email_not_verified"!==u.errorCode?r.default.createElement(r.default.Fragment,null,t):r.default.createElement(a,{sendEmail:function(){return l(d)},logout:n,email:c})},exports.EmailVerifiedNextPage=function(){return r.default.createElement(e.ChakraProvider,null,r.default.createElement(e.Center,{h:"100vh"},r.default.createElement(e.VStack,{textAlign:"center",spacing:"6"},r.default.createElement(e.Text,null,"Your email has been verified ðŸŽ‰"),r.default.createElement(e.Button,{onClick:function(){return window.location.assign("/admin")}},"Continue to UseCSV"))))},exports.VerifyYourAccount=a,exports.sendVerificationEmailHandler=function(e,t,n,r){return l(void 0,void 0,void 0,(function(){var a,l;return o(this,(function(o){switch(o.label){case 0:return[4,n(e.body.id)];case 1:return a=o.sent(),(l=a.data)||t.status(404).end(),l.email_verified&&t.json({url:"/admin"}),[4,r(e.body.id,l.email)];case 2:return o.sent(),t.status(200).end(),[2]}}))}))};
//# sourceMappingURL=index.js.map
